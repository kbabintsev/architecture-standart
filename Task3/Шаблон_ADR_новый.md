### **Название задачи:** ADR1 MVP Открытие депозитов онлайн

### **Автор:**Бабинцев Константин Сергеевич

### **Дата:**11.08.2025

### **Функциональные требования**

| **№** | **Действующие лица или системы**       | **Use Case**                                          | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | **Комментарий**                                    |
|:-----:|:---------------------------------------|:------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------|
|  UC1  | Новый клиент, сайт, система кол-центра | Просмотр доступных депозитов и заявка (сайт)          | 1. Пользователь находится в соответствующем разделе сайта<br/>2. Пользователь видит список доступных депозитов со ставками<br/>3. Пользователь может выбрать депозит и рассчитать доход за указанный срок (калькулятор)<br/>4. Пользователь может ввести свои ФИО и номер телефона для оформления заявки<br/>5. Заявка отправляется в систему кол-центра для последующей обработки                                                                                                             | Требования F1, F2. Для шага 4 предусмотреть капчу. |
|  UC2  | Клиент, интернет-банк, АБС             | Просмотр доступных депозитов и заявка (интернет-банк) | 1. Пользователь находится в соответствующем разделе интернет-банка<br/>2. Пользователь видит список доступных депозитов с актуальными ставками и персонализированные ставки лично для него.<br/>3. Пользователь может выбрать депозит и рассчитать доход за указанный срок (калькулятор)<br/>4. Пользователь может указать счёт и сумму депозита, чтобы подать заявку на открытие депозита<br/>5. Пользователь должен подтвердить операцию с помощью СМС-кода.<br/>Заявка регистрируется в АБС | Требования F3, F4.                                 |
|  UC3  | Специалист бэк-офиса, АБС              | Обработка заявки на депозит                           | 1. Пользователь находится в соответствующем разделе АБС<br/>2. Пользователь видит список заявок на депозит и может перейти в режим конкретной заявки<br/>3. Пользователь может утвердить заявку и открыть депозит.<br/>4. Клиент получает СМС-уведомление об открытии депозита                                                                                                                                                                                                                 | Требования F5, F6.                                 |

### **Нефункциональные требования**

| **№** | **Требование**                                                                                                                                                                                                                                     |
|:-----:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   R   | Надёжность (Reliability)                                                                                                                                                                                                                           |                                                                                                                                                                                                                           
|  R1   | Все сервисы должны работать 24/7 и быть доступны в 99,9% случаев.                                                                                                                                                                                  |
|  R2   | В случае сбоев в ЦОД необходимо, чтобы сервисы интернет-банка были доступны и выдерживали требуемую нагрузку. Фактически всё работает в одном ЦОД на одной группе серверов. У банка есть резервный ЦОД, в случае сбоя можно переключиться на него. |
|   P   | Производительность (Performance)                                                                                                                                                                                                                   |
|  P1   | Отклик по всем операциям должен быть максимально быстрым и занимать миллисекунды.                                                                                                                                                                  |
|  P2   | Лучше предусмотреть равномерное горизонтальное масштабирование и распределение запросов между серверами, приложениями и ЦОД. Но нужно учитывать, что АБС может масштабироваться только вертикально из-за своей базы данных.                        |
|  P3   | Команда АБС утверждает, что база данных системы уже перегружена.                                                                                                                                                                                   |
|  +R   | + Ограничения (Restrictions)                                                                                                                                                                                                                       |
|  +R1  | Данные клиентов необходимо защищать с помощью механизма шифрования трафика при передаче.                                                                                                                                                           |
|  +R2  | При доработках во всех системах нужно как можно больше использовать технологии, которые уже есть в банке (MS SQL, Oracle, Kafka).                                                                                                                  |
|  +R3  | Текущая версия платформы интернет-банка несовместима с Kafka.                                                                                                                                                                                      |
|  +R4  | Возможно, стоит подумать о переводе интернет-банка на микросервисную архитектуру, но пока только в рамках задачи открытия депозитов.                                                                                                               |
|  +R5  | Лучше избежать прямой работы интернет-банка с API АБС в новом процессе для обеспечения R1.                                                                                                                                                         |

### </a>**Решение**

[Диаграмма контекста](./Context.puml)<br/>
[Диаграмма контейнеров](./Container.puml)<br/>

#### </a>**Новая микросервисная архитектура**
* Постепенно система будет переводиться на горизонтально-масштабируемую микросервисную архитектуру: сервисы с автоскейлингом, шардированный MS SQL, репликация для обеспечения R1 и если потребуются региональные ЦОДы 
* В рамках задачи MVP открытия депозитов онлайн появились сервис депозитов и сервис расчета ставок. 
* Ставки публикуются в Kafka топики для последующего считывания новыми сервисами и старыми legacy-системами. 
* Так же Kafka, очень вероятно, пригодится для дальнейшего развитие микросервисной архитектуры.
* Появился API Gateway для гибкого управления траффиком.
* Предполагается, что сервис авторизации уже есть и он компанию устраивает (не хватает вводных).

#### </a>**Используемые технологии**
* Для реализации сервисов будем использовать ASP.NET Web API, т.к. это родственный фреймворк ASP.NET MVC, на котором реализован интернет-банк, а "команда банка может самостоятельно вносить изменения" в него, т.е. есть специалисты, которые как минимум знают язык программрования, на котором он реализован (C# или другой) и базовый .NET Framework.
* Для СУБД выбрали MS SQL Server, т.к. продукты MS хорошо интегрируется друг с другом и СУБД уже используется в интернет-банке, а значит есть разработчики и администраторы
* В качестве Message Broker выбрали Kafka, т.к. она уже используется банком, а значит есть разработчики и администраторы

### **Альтернативы**

#### Доработка существующих монолитов вместо разработки собственной микросервисной архитектуры
Наименее затратно, но это тупиковое развитие, тем более, что не все монолиты можно дорабатывать (например, ядро интеренет-банка недоступно к изменению). Немасштабируемое во всех смыслах. А так же требование +R4. 
#### Kubernetes для управления инфраструктурой
В вводной не было информации о том, что Kubernetes используется и есть специалисты. Тем более есть требование +R2.
#### Не ASP.NET
* Delphi не подойдет для серверной разработки
* Java Spring Boot - это реальная альтернатива, т.к. в команде АБС есть несколько специалистов с опытом в Java-стеке. Конечный выбор в пользу ASP.NET обусловлен лишь тем, что есть +R2, в котором была обозначена СУБД MS SQL, которая будет хорошо интегрироваться с ASP.NET. 
#### Не MS SQL
* СУБД Oracle уже используется в компании. Но Oracle дороже, сложнее в администрировании и в нем теряется смысл, т.к. бизнес-логика больше не будет имплементироваться в СУБД.
* PostgreSQL - это реальная альтернатива, но в требованиях +R2 обозначена не была.
#### Не Kafka
Один из самых популярных Message Broker'ов, гибкий, с широким функционалом. Тем более есть требование +R2.


